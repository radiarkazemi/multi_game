<!DOCTYPE html>
<html dir="rtl" lang="fa">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>ğŸ¯ Ø¶Ø±Ø¨â€ŒÛŒØ§Ø± | Ø¨Ø§Ø²ÛŒ Ø¬Ø¯ÙˆÙ„ Ø¶Ø±Ø¨</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;600;700;900&display=swap" rel="stylesheet">
<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RESET & VARIABLES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
*, *::before, *::after { margin:0; padding:0; box-sizing:border-box; }

:root {
  --bg:      #0f1117;
  --surface: #1a1d27;
  --card:    #21253a;
  --border:  rgba(255,255,255,0.08);
  --accent:  #6c8fff;
  --accent2: #a78bfa;
  --green:   #34d399;
  --red:     #f87171;
  --yellow:  #fbbf24;
  --text:    #e8eaf6;
  --muted:   #6b7280;
  --radius:  16px;
  --shadow:  0 8px 32px rgba(0,0,0,0.4);
}

html, body {
  height: 100%;
  font-family: 'Vazirmatn', 'Tahoma', sans-serif;
  background: var(--bg);
  color: var(--text);
  overflow-x: hidden;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BACKGROUND EFFECTS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
/* Noise texture */
body::before {
  content: '';
  position: fixed; inset: 0;
  background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.04'/%3E%3C/svg%3E");
  pointer-events: none; z-index: 0; opacity: 0.5;
}

/* Ambient glow blobs */
.blob {
  position: fixed; border-radius: 50%;
  filter: blur(80px); pointer-events: none; z-index: 0; opacity: 0.12;
}
.blob-1 { width:400px;height:400px;background:#6c8fff;top:-100px;right:-100px;animation:b1 12s ease-in-out infinite; }
.blob-2 { width:300px;height:300px;background:#a78bfa;bottom:-80px;left:-80px;animation:b2 15s ease-in-out infinite; }
.blob-3 { width:200px;height:200px;background:#34d399;top:50%;left:50%;transform:translate(-50%,-50%);animation:b3 10s ease-in-out infinite; }
@keyframes b1{0%,100%{transform:translate(0,0);}50%{transform:translate(-30px,30px);}}
@keyframes b2{0%,100%{transform:translate(0,0);}50%{transform:translate(30px,-20px);}}
@keyframes b3{0%,100%{transform:translate(-50%,-50%) scale(1);}50%{transform:translate(-50%,-50%) scale(1.3);}}

/* Floating clouds */
.cloud {
  position: fixed;
  background: rgba(255,255,255,0.12);
  border-radius: 100px;
  animation: floatCloud linear infinite;
  pointer-events: none;
  z-index: 0;
  filter: blur(1px);
}
.cloud::before, .cloud::after {
  content: '';
  position: absolute;
  background: rgba(255,255,255,0.12);
  border-radius: 100px;
}
.cloud-1 { width:110px;height:44px;top:12%;animation-duration:50s; }
.cloud-1::before { width:54px;height:54px;top:-27px;left:16px; }
.cloud-1::after  { width:64px;height:44px;top:-16px;right:16px; }
.cloud-2 { width:130px;height:50px;top:68%;animation-duration:65s;animation-delay:12s; }
.cloud-2::before { width:60px;height:60px;top:-30px;left:20px; }
.cloud-2::after  { width:70px;height:50px;top:-20px;right:20px; }
.cloud-3 { width:90px;height:36px;top:40%;animation-duration:44s;animation-delay:25s; }
.cloud-3::before { width:44px;height:44px;top:-22px;left:12px; }
.cloud-3::after  { width:52px;height:36px;top:-13px;right:12px; }
@keyframes floatCloud { from{left:-210px;} to{left:110%;} }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SCREEN SYSTEM
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.screen {
  position: relative; z-index: 1;
  min-height: 100dvh;
  display: flex; flex-direction: column;
  justify-content: center; align-items: center;
  padding: 20px 16px;
}
.screen.hidden { display: none !important; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   NAME ENTRY SCREEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.name-card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 28px;
  padding: clamp(28px,6vw,50px);
  width: 100%; max-width: 440px;
  text-align: center;
  box-shadow: var(--shadow);
  animation: cardIn 0.5s cubic-bezier(0.34,1.56,0.64,1);
}
@keyframes cardIn { from{opacity:0;transform:scale(0.9) translateY(20px);} to{opacity:1;transform:scale(1) translateY(0);} }

.brand-icon {
  font-size: 60px; display: block; margin-bottom: 10px;
  animation: iconFloat 3s ease-in-out infinite;
  filter: drop-shadow(0 0 20px rgba(108,143,255,0.5));
}
@keyframes iconFloat { 0%,100%{transform:translateY(0);} 50%{transform:translateY(-8px);} }

.brand-title {
  font-size: clamp(30px,7vw,44px); font-weight: 900; letter-spacing: -1px;
  background: linear-gradient(135deg,var(--accent),var(--accent2));
  -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text;
  margin-bottom: 6px;
}
.brand-sub { color: var(--muted); font-size: 15px; margin-bottom: 32px; }

.name-input {
  width: 100%; padding: 16px 20px;
  background: var(--card); border: 2px solid var(--border);
  border-radius: var(--radius);
  font-size: 18px; font-family: 'Vazirmatn','Tahoma',sans-serif;
  color: var(--text); text-align: right; outline: none;
  transition: border-color 0.2s, box-shadow 0.2s;
  margin-bottom: 8px;
}
.name-input:focus {
  border-color: var(--accent);
  box-shadow: 0 0 0 3px rgba(108,143,255,0.2);
}
.name-input::placeholder { color: var(--muted); }
.name-error { color: var(--red); font-size: 13px; min-height: 20px; margin-bottom: 14px; text-align: right; }

.btn-primary {
  width: 100%; padding: 16px;
  background: linear-gradient(135deg,var(--accent),var(--accent2));
  color: #fff; border: none; border-radius: var(--radius);
  font-size: 18px; font-weight: 700; font-family: 'Vazirmatn','Tahoma',sans-serif;
  cursor: pointer; transition: all 0.25s;
  box-shadow: 0 4px 24px rgba(108,143,255,0.4);
  margin-bottom: 12px;
}
.btn-primary:hover { transform: translateY(-2px); box-shadow: 0 8px 32px rgba(108,143,255,0.55); }
.btn-primary:active { transform: translateY(0); }

.btn-ghost {
  background: transparent; border: 1px solid var(--border);
  color: var(--muted); padding: 12px 20px;
  border-radius: 50px; font-size: 14px; font-weight: 600;
  font-family: 'Vazirmatn','Tahoma',sans-serif;
  cursor: pointer; transition: all 0.2s; width: 100%;
}
.btn-ghost:hover { border-color: var(--accent); color: var(--text); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SETTINGS SCREEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.settings-card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 24px;
  padding: clamp(24px,5vw,40px);
  width: 100%; max-width: 520px;
  box-shadow: var(--shadow);
  animation: cardIn 0.4s ease;
}
.back-link {
  display: flex; align-items: center; gap: 6px;
  color: var(--muted); font-size: 14px; font-weight: 600;
  cursor: pointer; margin-bottom: 20px;
  background: none; border: none; font-family: 'Vazirmatn','Tahoma',sans-serif;
  transition: color 0.2s;
}
.back-link:hover { color: var(--text); }
.player-greeting {
  background: var(--card); border: 1px solid var(--border);
  border-radius: 12px; padding: 12px 16px;
  font-size: 16px; font-weight: 600; color: var(--accent);
  margin-bottom: 20px; text-align: center;
}
.setting-section { margin-bottom: 22px; }
.setting-label {
  font-size: 12px; font-weight: 700; color: var(--muted);
  text-transform: uppercase; letter-spacing: 1px;
  margin-bottom: 12px; display: flex; align-items: center; gap: 6px;
}
.chip-group { display: flex; gap: 8px; flex-wrap: wrap; }
.chip { position: relative; }
.chip input[type="radio"] { position: absolute; opacity: 0; width: 0; height: 0; }
.chip label {
  display: block; padding: 10px 18px;
  background: var(--card); border: 2px solid var(--border);
  border-radius: 50px; cursor: pointer;
  font-size: 14px; font-family: 'Vazirmatn','Tahoma',sans-serif;
  font-weight: 600; color: var(--muted);
  transition: all 0.2s; white-space: nowrap; user-select: none;
}
.chip label:hover { border-color: var(--accent); color: var(--text); transform: translateY(-2px); }
.chip input:checked + label {
  background: linear-gradient(135deg,var(--accent),var(--accent2));
  border-color: transparent; color: #fff;
  box-shadow: 0 4px 16px rgba(108,143,255,0.4);
}
.sep { height: 1px; background: var(--border); margin: 20px 0; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   GAME SCREEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.game-wrap {
  width: 100%; max-width: 620px;
  display: flex; flex-direction: column; gap: 12px;
}

/* top bar */
.top-bar {
  display: flex; align-items: center;
  justify-content: space-between; gap: 8px;
  flex-wrap: wrap;
}
.icon-btn {
  background: var(--card); border: 1px solid var(--border);
  border-radius: 10px; padding: 9px 13px;
  font-size: 18px; cursor: pointer; color: var(--muted);
  transition: all 0.2s; line-height: 1;
}
.icon-btn:hover { color: var(--text); border-color: var(--accent); transform: translateY(-1px); }

.level-pill {
  background: linear-gradient(135deg,var(--accent),var(--accent2));
  color: #fff; padding: 9px 18px; border-radius: 50px;
  font-size: clamp(12px,3.2vw,15px); font-weight: 700;
  box-shadow: 0 2px 12px rgba(108,143,255,0.35);
  text-align: center; flex: 1;
}
.score-pill {
  background: var(--card); border: 1px solid var(--border);
  padding: 9px 14px; border-radius: 50px;
  font-size: 14px; font-weight: 700; color: var(--yellow); white-space: nowrap;
  transition: transform 0.2s;
}
.score-pill.bump { animation: scoreBump 0.3s ease; }
@keyframes scoreBump { 0%,100%{transform:scale(1);} 50%{transform:scale(1.2);} }

/* progress */
.progress-track { height: 6px; background: var(--card); border-radius: 99px; overflow: hidden; }
.progress-bar {
  height: 100%;
  background: linear-gradient(90deg,var(--accent),var(--accent2));
  border-radius: 99px; transition: width 0.5s cubic-bezier(0.4,0,0.2,1);
}

/* timer bar */
.timer-track { height: 5px; background: var(--card); border-radius: 99px; overflow: hidden; display: none; }
.timer-track.on { display: block; }
.timer-bar { height: 100%; background: var(--green); border-radius: 99px; width: 100%; transition: background 0.5s; }
.timer-bar.warn   { background: var(--yellow); }
.timer-bar.danger { background: var(--red); animation: dangerPulse 0.4s infinite; }
@keyframes dangerPulse { 0%,100%{opacity:1;} 50%{opacity:0.4;} }

.q-meta {
  display: flex; justify-content: space-between;
  font-size: 12px; color: var(--muted); font-weight: 600;
}

/* â”€â”€ ANSWER BUBBLE â”€â”€ */
.answer-bubble {
  background: var(--surface); border: 2px solid var(--border);
  border-radius: 24px; text-align: center;
  padding: clamp(24px,5vw,42px) 20px;
  position: relative; overflow: hidden;
  transition: border-color 0.3s;
}
.answer-bubble::before {
  content: ''; position: absolute; inset: 0;
  background: radial-gradient(ellipse at 50% 0%,rgba(108,143,255,0.12),transparent 70%);
  pointer-events: none;
}
.answer-bubble.correct-glow { border-color: var(--green); }
.answer-bubble.wrong-glow   { border-color: var(--red); }

.answer-label {
  font-size: 12px; color: var(--muted); font-weight: 700;
  letter-spacing: 1px; text-transform: uppercase; margin-bottom: 8px;
}
.answer-number {
  font-size: clamp(70px,18vw,100px); font-weight: 900; line-height: 1;
  background: linear-gradient(135deg,#fff 30%,var(--accent2));
  -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
  filter: drop-shadow(0 0 30px rgba(167,139,250,0.35));
}
.answer-number.pop { animation: numPop 0.4s cubic-bezier(0.36,0.07,0.19,0.97); }
@keyframes numPop { 0%{transform:scale(0.6);opacity:0;} 60%{transform:scale(1.1);} 100%{transform:scale(1);opacity:1;} }

/* hint */
.hint-row { display: flex; justify-content: center; min-height: 36px; align-items: center; gap: 10px; }
.hint-btn {
  background: transparent; border: 1px solid var(--border);
  border-radius: 50px; padding: 7px 18px;
  font-size: 13px; color: var(--muted); cursor: pointer;
  font-family: 'Vazirmatn','Tahoma',sans-serif; font-weight: 600;
  transition: all 0.2s; display: none;
}
.hint-btn:hover { border-color: var(--yellow); color: var(--yellow); }
.hint-btn:disabled { opacity: 0.35; cursor: not-allowed; }
.hint-chip {
  background: rgba(251,191,36,0.12); border: 1px solid rgba(251,191,36,0.3);
  border-radius: 8px; padding: 7px 14px;
  font-size: 14px; color: var(--yellow); font-weight: 600;
  display: none; animation: chipIn 0.3s ease;
}
.hint-chip.show { display: block; }
@keyframes chipIn { from{opacity:0;transform:translateY(-6px);} to{opacity:1;transform:translateY(0);} }

/* â”€â”€ OPTIONS â”€â”€ */
.options-grid {
  display: grid; grid-template-columns: 1fr 1fr; gap: 10px;
}
@media(min-width:560px) { .options-grid { grid-template-columns: repeat(4,1fr); } }

.opt-btn {
  background: var(--card); border: 2px solid var(--border);
  border-radius: var(--radius);
  padding: clamp(16px,4vw,24px) 10px;
  font-size: clamp(17px,4.5vw,24px); font-weight: 700;
  font-family: 'Vazirmatn','Tahoma',sans-serif;
  color: var(--text); cursor: pointer;
  transition: all 0.25s cubic-bezier(0.4,0,0.2,1);
  text-align: center; user-select: none;
  -webkit-tap-highlight-color: transparent;
  position: relative; overflow: hidden;
}
/* shimmer on hover */
.opt-btn::after {
  content: '';
  position: absolute; top: -50%; left: -75%;
  width: 50%; height: 200%;
  background: linear-gradient(to right,transparent,rgba(255,255,255,0.12),transparent);
  transform: skewX(-20deg);
  transition: left 0.4s;
}
.opt-btn:hover::after { left: 125%; }
.opt-btn:hover {
  border-color: var(--accent); transform: translateY(-4px);
  box-shadow: 0 8px 24px rgba(108,143,255,0.3);
}
.opt-btn:active { transform: translateY(-1px); }

/* floating animation â€“ staggered */
.opt-btn { animation: optFloat 3s ease-in-out infinite; }
.opt-btn:nth-child(1) { animation-delay: 0s; }
.opt-btn:nth-child(2) { animation-delay: 0.4s; }
.opt-btn:nth-child(3) { animation-delay: 0.8s; }
.opt-btn:nth-child(4) { animation-delay: 1.2s; }
@keyframes optFloat {
  0%,100% { transform: translateY(0); }
  50%      { transform: translateY(-6px); }
}
.opt-btn:hover { animation-play-state: paused; }

.opt-btn.correct {
  background: rgba(52,211,153,0.18); border-color: var(--green); color: var(--green);
  animation: correctPop 0.45s ease forwards;
}
.opt-btn.wrong {
  background: rgba(248,113,113,0.15); border-color: var(--red); color: var(--red);
  animation: wrongShake 0.4s ease forwards;
}
@keyframes correctPop { 0%{transform:scale(1);} 35%{transform:scale(1.1);} 70%{transform:scale(0.97);} 100%{transform:scale(1);} }
@keyframes wrongShake { 0%,100%{transform:translateX(0);} 20%{transform:translateX(-8px);} 60%{transform:translateX(8px);} }

/* feedback */
.feedback {
  text-align: center; font-size: clamp(16px,4vw,20px);
  font-weight: 700; min-height: 32px; padding: 4px 0;
  transition: all 0.3s;
}
.feedback.ok   { color: var(--green); }
.feedback.bad  { color: var(--red); }
.feedback.info { color: var(--accent); }

/* â”€â”€ FLOATING STARS (burst on correct) â”€â”€ */
.star-layer { position: fixed; inset: 0; pointer-events: none; z-index: 999; overflow: hidden; }
.fstar {
  position: absolute; font-size: 28px;
  animation: fstar 1s ease-out forwards;
}
@keyframes fstar {
  0%   { opacity: 0; transform: scale(0) rotate(0deg) translateY(0); }
  30%  { opacity: 1; transform: scale(1.4) rotate(120deg) translateY(-15px); }
  100% { opacity: 0; transform: scale(0.6) rotate(280deg) translateY(-70px); }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LEADERBOARD MODAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.modal-overlay {
  position: fixed; inset: 0; background: rgba(0,0,0,0.75);
  z-index: 100; display: flex; align-items: center; justify-content: center;
  padding: 16px; backdrop-filter: blur(6px);
  animation: overlayIn 0.2s ease;
}
.modal-overlay.hidden { display: none; }
@keyframes overlayIn { from{opacity:0;} to{opacity:1;} }

.modal {
  background: var(--surface); border: 1px solid var(--border);
  border-radius: 24px; width: 100%; max-width: 480px;
  max-height: 88dvh; overflow: hidden;
  display: flex; flex-direction: column;
  box-shadow: 0 24px 60px rgba(0,0,0,0.6);
  animation: modalIn 0.28s cubic-bezier(0.34,1.56,0.64,1);
}
@keyframes modalIn { from{transform:scale(0.88);opacity:0;} to{transform:scale(1);opacity:1;} }

.modal-head {
  display: flex; align-items: center; justify-content: space-between;
  padding: 20px 24px 16px; border-bottom: 1px solid var(--border);
}
.modal-title { font-size: 20px; font-weight: 900; }
.modal-close {
  background: var(--card); border: 1px solid var(--border);
  border-radius: 8px; padding: 6px 11px; font-size: 16px;
  cursor: pointer; color: var(--muted); transition: all 0.2s;
}
.modal-close:hover { color: var(--text); border-color: var(--red); }

.modal-body { overflow-y: auto; padding: 16px 24px 24px; flex: 1; }

.lb-tabs {
  display: flex; gap: 6px; margin-bottom: 16px; flex-wrap: wrap;
}
.lb-tab {
  padding: 7px 16px; border-radius: 50px; font-size: 13px; font-weight: 600;
  font-family: 'Vazirmatn','Tahoma',sans-serif;
  border: 1px solid var(--border); background: var(--card);
  color: var(--muted); cursor: pointer; transition: all 0.2s;
}
.lb-tab.active {
  background: linear-gradient(135deg,var(--accent),var(--accent2));
  border-color: transparent; color: #fff;
}

.lb-list { display: flex; flex-direction: column; gap: 8px; }
.lb-empty { text-align: center; color: var(--muted); padding: 40px 0; font-size: 15px; }
.lb-loading { text-align: center; color: var(--muted); padding: 40px 0; font-size: 24px; }

.lb-row {
  display: flex; align-items: center; gap: 12px;
  background: var(--card); border: 1px solid var(--border);
  border-radius: 12px; padding: 12px 16px;
  transition: all 0.2s;
  animation: rowIn 0.3s ease both;
}
@keyframes rowIn { from{opacity:0;transform:translateX(-10px);} to{opacity:1;transform:translateX(0);} }
.lb-row.me    { border-color: var(--accent); background: rgba(108,143,255,0.08); }
.lb-row.top-1 { border-color: var(--yellow); background: rgba(251,191,36,0.07); }
.lb-row.top-2 { border-color: #9ca3af;       background: rgba(156,163,175,0.06); }
.lb-row.top-3 { border-color: #cd7c2f;       background: rgba(205,124,47,0.06); }

.lb-rank { font-size: 20px; width: 34px; text-align: center; flex-shrink: 0; }
.lb-info { flex: 1; min-width: 0; }
.lb-name { font-size: 15px; font-weight: 700; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.lb-sub  { font-size: 12px; color: var(--muted); margin-top: 2px; }
.lb-score-val { font-size: 18px; font-weight: 900; color: var(--yellow); }
.lb-del {
  background: none; border: none; color: var(--muted);
  cursor: pointer; font-size: 16px; padding: 4px 6px;
  display: none; transition: color 0.2s; border-radius: 6px;
}
.lb-del:hover { color: var(--red); background: rgba(248,113,113,0.1); }
.teacher-mode .lb-del { display: block; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   END SCREEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.end-card {
  background: var(--surface); border: 1px solid var(--border);
  border-radius: 28px; padding: clamp(28px,6vw,50px);
  width: 100%; max-width: 440px; text-align: center;
  box-shadow: var(--shadow);
  animation: cardIn 0.5s cubic-bezier(0.34,1.56,0.64,1);
}
.end-trophy {
  font-size: 86px; display: block; margin-bottom: 12px;
  animation: trophyBob 2s ease-in-out infinite;
  filter: drop-shadow(0 0 20px rgba(251,191,36,0.4));
}
@keyframes trophyBob { 0%,100%{transform:translateY(0) rotate(-4deg);} 50%{transform:translateY(-12px) rotate(4deg);} }
.end-title { font-size: clamp(26px,6vw,36px); font-weight: 900; margin-bottom: 6px; }
.end-grade { font-size: clamp(15px,4vw,18px); color: var(--muted); margin-bottom: 20px; }

.end-stats {
  background: var(--card); border-radius: var(--radius);
  padding: 16px 20px; margin-bottom: 16px;
  display: flex; justify-content: space-around; gap: 8px;
}
.end-stat-val { font-size: clamp(22px,5vw,30px); font-weight: 900; color: var(--yellow); }
.end-stat-lbl { font-size: 12px; color: var(--muted); margin-top: 2px; }

.rank-banner {
  background: rgba(108,143,255,0.1); border: 1px solid rgba(108,143,255,0.25);
  border-radius: 12px; padding: 14px 16px;
  margin-bottom: 20px; font-size: 15px; font-weight: 700; color: var(--accent);
  min-height: 52px; display: flex; align-items: center; justify-content: center;
}
.btn-row { display: flex; flex-direction: column; gap: 10px; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   JSONBIN CONFIG BANNER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.config-notice {
  background: rgba(251,191,36,0.1); border: 1px solid rgba(251,191,36,0.3);
  border-radius: 12px; padding: 14px 16px; margin-bottom: 16px;
  font-size: 13px; color: var(--yellow); text-align: right; line-height: 1.7;
}
.config-notice a { color: var(--accent); }

</style>
</head>
<body>

<!-- BG -->
<div class="blob blob-1"></div>
<div class="blob blob-2"></div>
<div class="blob blob-3"></div>
<div class="cloud cloud-1"></div>
<div class="cloud cloud-2"></div>
<div class="cloud cloud-3"></div>
<div class="star-layer" id="starLayer"></div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     LEADERBOARD MODAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="modal-overlay hidden" id="lbOverlay" onclick="closeLBOutside(event)">
  <div class="modal">
    <div class="modal-head">
      <div class="modal-title">ğŸ† ØªØ§Ø¨Ù„ÙˆÛŒ Ø§Ù…ØªÛŒØ§Ø²Ø§Øª</div>
      <button class="modal-close" onclick="closeLB()">âœ•</button>
    </div>
    <div class="modal-body">
      <div class="lb-tabs">
        <button class="lb-tab active" onclick="setTab('all',this)">Ù‡Ù…Ù‡</button>
        <button class="lb-tab" onclick="setTab('easy',this)">ğŸ˜Š Ø¢Ø³Ø§Ù†</button>
        <button class="lb-tab" onclick="setTab('normal',this)">ğŸ™‚ Ù…ØªÙˆØ³Ø·</button>
        <button class="lb-tab" onclick="setTab('hard',this)">ğŸ˜¤ Ø³Ø®Øª</button>
      </div>
      <div id="lbContent"><div class="lb-loading">â³</div></div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SCREEN: NAME
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="screen" id="nameScreen">
  <div class="name-card">
    <span class="brand-icon">ğŸ¯</span>
    <div class="brand-title">Ø¶Ø±Ø¨â€ŒÛŒØ§Ø±</div>
    <div class="brand-sub">Ø¨Ø§Ø²ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯ Ø¬Ø¯ÙˆÙ„ Ø¶Ø±Ø¨</div>

    <input class="name-input" id="nameInput"
      type="text" placeholder="Ø§Ø³Ù…Øª Ø±Ùˆ Ø¨Ù†ÙˆÛŒØ³..."
      maxlength="30" autocomplete="off"
      onkeydown="if(event.key==='Enter') goSettings()">
    <div class="name-error" id="nameError"></div>

    <button class="btn-primary" onclick="goSettings()">Ø§Ø¯Ø§Ù…Ù‡ â†</button>
    <button class="btn-ghost"   onclick="openLB()">ğŸ† ØªØ§Ø¨Ù„ÙˆÛŒ Ø§Ù…ØªÛŒØ§Ø²Ø§Øª</button>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SCREEN: SETTINGS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="screen hidden" id="settingsScreen">
  <div class="settings-card">
    <button class="back-link" onclick="show('nameScreen')">â† ØªØºÛŒÛŒØ± Ù†Ø§Ù…</button>
    <div class="player-greeting" id="playerGreeting">Ø³Ù„Ø§Ù…! Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ§ÛŒØŸ ğŸ‘‹</div>

    <div class="setting-section">
      <div class="setting-label">ğŸ“‹ ØªØ¹Ø¯Ø§Ø¯ Ø³ÙˆØ§Ù„ Ù‡Ø± Ù…Ø±Ø­Ù„Ù‡</div>
      <div class="chip-group">
        <div class="chip"><input type="radio" id="q3"  name="qpl" value="3"><label for="q3">Û³ â€” Ø³Ø±ÛŒØ¹</label></div>
        <div class="chip"><input type="radio" id="q5"  name="qpl" value="5" checked><label for="q5">Ûµ â€” Ù…Ø¹Ù…ÙˆÙ„ÛŒ</label></div>
        <div class="chip"><input type="radio" id="q10" name="qpl" value="10"><label for="q10">Û±Û° â€” Ú©Ø§Ù…Ù„</label></div>
      </div>
    </div>
    <div class="sep"></div>
    <div class="setting-section">
      <div class="setting-label">ğŸ® Ø³Ø·Ø­ Ø¯Ø´ÙˆØ§Ø±ÛŒ</div>
      <div class="chip-group">
        <div class="chip"><input type="radio" id="easy"   name="diff" value="easy" checked><label for="easy">ğŸ˜Š Ø¢Ø³Ø§Ù† â€” Ø¨Ø§ Ø±Ø§Ù‡Ù†Ù…Ø§</label></div>
        <div class="chip"><input type="radio" id="normal" name="diff" value="normal"><label for="normal">ğŸ™‚ Ù…ØªÙˆØ³Ø·</label></div>
        <div class="chip"><input type="radio" id="hard"   name="diff" value="hard"><label for="hard">ğŸ˜¤ Ø³Ø®Øª</label></div>
      </div>
    </div>
    <div class="sep"></div>
    <div class="setting-section">
      <div class="setting-label">â±ï¸ Ø²Ù…Ø§Ù† Ù‡Ø± Ø³ÙˆØ§Ù„</div>
      <div class="chip-group">
        <div class="chip"><input type="radio" id="t0"  name="time" value="0" checked><label for="t0">Ø¨ÛŒâ€ŒÙ…Ø­Ø¯ÙˆØ¯ÛŒØª</label></div>
        <div class="chip"><input type="radio" id="t15" name="time" value="15"><label for="t15">Û±Ûµ Ø«Ø§Ù†ÛŒÙ‡</label></div>
        <div class="chip"><input type="radio" id="t30" name="time" value="30"><label for="t30">Û³Û° Ø«Ø§Ù†ÛŒÙ‡</label></div>
        <div class="chip"><input type="radio" id="t60" name="time" value="60"><label for="t60">Û¶Û° Ø«Ø§Ù†ÛŒÙ‡</label></div>
      </div>
    </div>
    <div class="sep"></div>
    <button class="btn-primary" onclick="startGame()">ğŸš€ Ø´Ø±ÙˆØ¹ Ø¨Ø§Ø²ÛŒ</button>
    <div style="height:10px"></div>
    <button class="btn-ghost"   onclick="openLB()">ğŸ† ØªØ§Ø¨Ù„ÙˆÛŒ Ø§Ù…ØªÛŒØ§Ø²Ø§Øª</button>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SCREEN: GAME
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="screen hidden" id="gameScreen">
  <div class="game-wrap">

    <div class="top-bar">
      <button class="icon-btn" onclick="confirmBack()">â†</button>
      <div class="level-pill" id="levelPill">Ù…Ø±Ø­Ù„Ù‡ Û± â€” Ø¬Ø¯ÙˆÙ„ Û²</div>
      <div style="display:flex;gap:6px;align-items:center">
        <div class="score-pill" id="scorePill">â­ <span id="scoreEl">Û°</span></div>
        <button class="icon-btn" onclick="openLB()">ğŸ†</button>
      </div>
    </div>

    <div class="progress-track"><div class="progress-bar" id="progBar" style="width:0%"></div></div>
    <div class="timer-track" id="timerTrack"><div class="timer-bar" id="timerBar"></div></div>

    <div class="q-meta">
      <span id="qCounter">Ø³ÙˆØ§Ù„ Û± Ø§Ø² Ûµ</span>
      <span id="qMeta">Ù…Ø±Ø­Ù„Ù‡ Û± Ø§Ø² Û¸</span>
    </div>

    <div class="answer-bubble" id="answerBubble">
      <div class="answer-label">Ø­Ø§ØµÙ„ Ø¶Ø±Ø¨</div>
      <div class="answer-number" id="answerNum">?</div>
    </div>

    <div class="hint-row">
      <button class="hint-btn" id="hintBtn" onclick="doHint()">ğŸ’¡ Ø±Ø§Ù‡Ù†Ù…Ø§ (âˆ’Û³ Ø§Ù…ØªÛŒØ§Ø²)</button>
      <div class="hint-chip" id="hintChip"></div>
    </div>

    <div class="options-grid" id="optGrid"></div>
    <div class="feedback" id="feedback"></div>

  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SCREEN: END
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="screen hidden" id="endScreen">
  <div class="end-card">
    <span class="end-trophy" id="endTrophy">ğŸ†</span>
    <div class="end-title" id="endTitle">ØªØ¨Ø±ÛŒÚ©!</div>
    <div class="end-grade" id="endGrade"></div>
    <div class="end-stats">
      <div class="end-stat"><div class="end-stat-val" id="endScore">Û°</div><div class="end-stat-lbl">Ø§Ù…ØªÛŒØ§Ø²</div></div>
      <div class="end-stat"><div class="end-stat-val" id="endMax">Û°</div><div class="end-stat-lbl">Ø­Ø¯Ø§Ú©Ø«Ø±</div></div>
      <div class="end-stat"><div class="end-stat-val" id="endPct">Û°Ùª</div><div class="end-stat-lbl">Ø¯Ø±ØµØ¯</div></div>
    </div>
    <div class="rank-banner" id="rankBanner">â³ Ø¯Ø± Ø­Ø§Ù„ Ø«Ø¨Øª...</div>
    <div class="btn-row">
      <button class="btn-primary" onclick="location.reload()">ğŸ”„ Ø¨Ø§Ø²ÛŒ Ø¯ÙˆØ¨Ø§Ø±Ù‡</button>
      <button class="btn-ghost"   onclick="openLB()">ğŸ† ØªØ§Ø¨Ù„ÙˆÛŒ Ø§Ù…ØªÛŒØ§Ø²Ø§Øª</button>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SCRIPT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<script>
/* â”€â”€â”€ CONFIG â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   JSONBin.io â€” Ø±Ø§ÛŒÚ¯Ø§Ù†ØŒ Ø¨Ø¯ÙˆÙ† Ù†ØµØ¨ØŒ ÙÙ‚Ø· ÛŒÙ‡â€ŒØ¨Ø§Ø± Ø¨Ø§ÛŒØ¯ BIN_ID Ùˆ API_KEY Ø±Ùˆ Ù¾Ø± Ú©Ù†ÛŒ.

   Ù…Ø±Ø§Ø­Ù„:
   1. Ø¨Ø±Ùˆ Ø¨Ù‡  https://jsonbin.io  Ùˆ Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ú©Ù† (Ø±Ø§ÛŒÚ¯Ø§Ù†Ù‡)
   2. API Keys â†’ Create Access Key â†’ Ú©Ù¾ÛŒ Ú©Ù†
   3. Bins â†’ Create Bin â†’ Ø¨Ø§ Ø§ÛŒÙ† Ù…Ø­ØªÙˆØ§:  []
   4. BIN ID Ø±Ùˆ Ø§Ø² Ø¢Ø¯Ø±Ø³ Ú©Ù¾ÛŒ Ú©Ù†  (Ù…Ø«Ù„Ø§Ù‹ 6630f1...)
   5. Ø¯Ùˆ Ø®Ø· Ø²ÛŒØ± Ø±Ùˆ Ù¾Ø± Ú©Ù† Ùˆ ÙØ§ÛŒÙ„ Ø±Ùˆ Ø°Ø®ÛŒØ±Ù‡ Ú©Ù†
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const JSONBIN_ID  = '698df078d0ea881f40b538e1';
const JSONBIN_KEY = '$2a$10$qZxw1FtHe.7UpldJIczmfuU7llZwyHddH96i5jIWbAApxTg6vBakO';

const API_BASE = `https://api.jsonbin.io/v3/b/${JSONBIN_ID}`;
const HEADERS  = {
  'Content-Type': 'application/json',
  'X-Master-Key': JSONBIN_KEY,
  'X-Access-Key': JSONBIN_KEY
};

/* â”€â”€â”€ HELPERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const FARSI = ['Û°','Û±','Û²','Û³','Û´','Ûµ','Û¶','Û·','Û¸','Û¹'];
const toF   = n => String(n).replace(/\d/g, d => FARSI[+d]);
const $     = id => document.getElementById(id);
const LEVELS = [2,3,4,5,6,7,8,9];  // Ø¬Ø¯ÙˆÙ„ Û² ØªØ§ Û¹
const DIFF_FA = { easy:'Ø¢Ø³Ø§Ù†', normal:'Ù…ØªÙˆØ³Ø·', hard:'Ø³Ø®Øª' };

/* â”€â”€â”€ STATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
let playerName = '';
let levelIdx   = 0;
let qIdx       = 1;
let score      = 0;
let answer     = 0;
let busy       = false;
let hintUsed   = false;
let qPerLevel  = 5;
let difficulty = 'easy';
let timeLimit  = 0;
let timerSec   = 0;
let timerHandle = null;
let lbTab      = 'all';
let allScores  = [];
let teacherMode = false;

/* â”€â”€â”€ SCREEN MANAGER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function show(id) {
  ['nameScreen','settingsScreen','gameScreen','endScreen'].forEach(s => {
    $(s).classList.toggle('hidden', s !== id);
  });
}

/* â”€â”€â”€ NAME SCREEN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function goSettings() {
  const raw = $('nameInput').value.trim();
  if (!raw)       { $('nameError').textContent = 'Ù„Ø·ÙØ§Ù‹ Ø§Ø³Ù…Øª Ø±Ùˆ Ø¨Ù†ÙˆÛŒØ³'; return; }
  if (raw.length < 2) { $('nameError').textContent = 'Ø­Ø¯Ø§Ù‚Ù„ Û² Ø­Ø±Ù'; return; }
  $('nameError').textContent = '';
  playerName = raw;
  teacherMode = (playerName.toLowerCase() === 'teacher');
  $('playerGreeting').textContent = `Ø³Ù„Ø§Ù… ${playerName}! Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ§ÛŒØŸ ğŸ‘‹`;
  show('settingsScreen');
}

/* â”€â”€â”€ SETTINGS â†’ START â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function startGame() {
  qPerLevel  = +document.querySelector('input[name="qpl"]:checked').value;
  difficulty = document.querySelector('input[name="diff"]:checked').value;
  timeLimit  = +document.querySelector('input[name="time"]:checked').value;
  if (difficulty === 'hard' && timeLimit === 0) timeLimit = 20;

  $('hintBtn').style.display = difficulty === 'easy' ? 'inline-block' : 'none';
  $('timerTrack').classList.toggle('on', timeLimit > 0);

  levelIdx = 0; qIdx = 1; score = 0;
  $('scoreEl').textContent = toF(0);
  show('gameScreen');
  newQuestion();
}

function confirmBack() {
  if (!confirm('Ø¨Ù‡ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¨Ø±Ú¯Ø±Ø¯ÛŒØŸ Ù¾ÛŒØ´Ø±ÙØª Ù¾Ø§Ú© Ù…ÛŒâ€ŒØ´ÙˆØ¯.')) return;
  stopTimer();
  show('settingsScreen');
}

/* â”€â”€â”€ QUESTION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function newQuestion() {
  if (levelIdx >= LEVELS.length) { endGame(); return; }

  busy = false; hintUsed = false;
  $('hintBtn').disabled = false;
  $('hintChip').classList.remove('show');
  $('feedback').textContent = '';
  $('feedback').className = 'feedback';
  $('answerBubble').classList.remove('correct-glow','wrong-glow');

  const table = LEVELS[levelIdx];
  const mult  = Math.floor(Math.random() * 10) + 1;
  answer = table * mult;

  const numEl = $('answerNum');
  numEl.textContent = toF(answer);
  numEl.classList.remove('pop');
  void numEl.offsetWidth;
  numEl.classList.add('pop');

  $('levelPill').textContent = `Ù…Ø±Ø­Ù„Ù‡ ${toF(levelIdx+1)} â€” Ø¬Ø¯ÙˆÙ„ ${toF(table)}`;
  $('qCounter').textContent  = `Ø³ÙˆØ§Ù„ ${toF(qIdx)} Ø§Ø² ${toF(qPerLevel)}`;
  $('qMeta').textContent     = `Ù…Ø±Ø­Ù„Ù‡ ${toF(levelIdx+1)} Ø§Ø² ${toF(LEVELS.length)}`;

  buildOptions();
  updateProgress();
  startTimer();
}

/* â”€â”€â”€ OPTIONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function buildOptions() {
  const grid = $('optGrid');
  grid.innerHTML = '';
  const pool = new Set([answer]);
  let t = 0;
  while (pool.size < 4 && t++ < 300)
    pool.add((Math.floor(Math.random()*9)+1)*(Math.floor(Math.random()*10)+1));

  const pairFor = p => {
    for (let a = 1; a <= 9; a++) {
      const b = p / a;
      if (Number.isInteger(b) && b >= 1 && b <= 10) return `${toF(a)} Ã— ${toF(b)}`;
    }
    return toF(p);
  };

  [...pool].sort(()=>Math.random()-.5).forEach(prod => {
    const btn = document.createElement('button');
    btn.className = 'opt-btn';
    btn.textContent = pairFor(prod);
    btn.onclick = () => pick(btn, prod);
    grid.appendChild(btn);
  });
}

/* â”€â”€â”€ PICK â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function pick(el, chosen) {
  if (busy) return;
  busy = true;
  stopTimer();

  if (chosen === answer) {
    el.classList.add('correct');
    $('answerBubble').classList.add('correct-glow');
    score += hintUsed ? 7 : 10;
    $('scoreEl').textContent = toF(score);

    /* score bump animation */
    const pill = $('scorePill');
    pill.classList.remove('bump');
    void pill.offsetWidth;
    pill.classList.add('bump');

    $('feedback').textContent = hintUsed ? 'ğŸ‘ Ø¯Ø±Ø³Øª! (Ø¨Ø§ Ø±Ø§Ù‡Ù†Ù…Ø§)' : randPraise();
    $('feedback').className = 'feedback ok';
    spawnStars();

    qIdx++;
    if (qIdx > qPerLevel) {
      levelIdx++; qIdx = 1;
      if (levelIdx < LEVELS.length) {
        $('feedback').textContent = `ğŸŠ Ù…Ø±Ø­Ù„Ù‡ ${toF(levelIdx+1)} Ø´Ø±ÙˆØ¹ Ø´Ø¯!`;
        $('feedback').className = 'feedback info';
        $('levelPill').textContent = `Ù…Ø±Ø­Ù„Ù‡ ${toF(levelIdx+1)} â€” Ø¬Ø¯ÙˆÙ„ ${toF(LEVELS[levelIdx])}`;
        setTimeout(() => { $('feedback').textContent=''; newQuestion(); }, 1700);
        return;
      }
    }
    setTimeout(() => { $('feedback').textContent=''; newQuestion(); }, 1300);

  } else {
    el.classList.add('wrong');
    $('answerBubble').classList.add('wrong-glow');
    $('feedback').textContent = randWrong();
    $('feedback').className = 'feedback bad';
    setTimeout(() => {
      el.classList.remove('wrong');
      $('answerBubble').classList.remove('wrong-glow');
      $('feedback').textContent = '';
      busy = false;
      if (timeLimit > 0) resumeTimer();
    }, 900);
  }
}

const PRAISES = ['ğŸ‰ Ø¢ÙØ±ÛŒÙ†! Ø¹Ø§Ù„ÛŒÙ‡!','ğŸŒŸ ÙÙˆÙ‚â€ŒØ§Ù„Ø¹Ø§Ø¯Ù‡!','ğŸ’ª Ø¯Ø±Ø³ØªÙ‡!','ğŸ”¥ Ù…Ø­Ø´Ø±Ù‡!','âœ¨ Ù…Ù…ØªØ§Ø²!','âš¡ Ø³Ø±ÛŒØ¹!'];
const WRONGS  = ['âŒ Ù†Ù‡ØŒ Ø¯ÙˆØ¨Ø§Ø±Ù‡!','ğŸ˜… Ø§Ø´ØªØ¨Ø§Ù‡Ù‡!','ğŸ¤” Ø¯Ù‚ÛŒÙ‚â€ŒØªØ± ÙÚ©Ø± Ú©Ù†!','ğŸ˜¬ Ù†Ø²Ø¯ÛŒÚ© Ø¨ÙˆØ¯!'];
const randPraise = () => PRAISES[Math.floor(Math.random()*PRAISES.length)];
const randWrong  = () => WRONGS [Math.floor(Math.random()*WRONGS.length)];

/* â”€â”€â”€ HINT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function doHint() {
  if (hintUsed) return;
  hintUsed = true;
  $('hintBtn').disabled = true;
  const chip = $('hintChip');
  chip.textContent = `${toF(LEVELS[levelIdx])} Ã— ${toF(answer/LEVELS[levelIdx])} = ${toF(answer)}`;
  chip.classList.add('show');
  setTimeout(() => chip.classList.remove('show'), 4500);
}

/* â”€â”€â”€ TIMER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function startTimer() {
  if (!timeLimit) return;
  timerSec = timeLimit;
  const bar = $('timerBar');
  bar.style.transition = 'none'; bar.style.width = '100%'; bar.className = 'timer-bar';
  void bar.offsetWidth;
  bar.style.transition = `width ${timeLimit}s linear`; bar.style.width = '0%';
  timerHandle = setInterval(tickTimer, 1000);
}
function resumeTimer() {
  if (!timeLimit || timerSec <= 0) return;
  $('timerBar').style.transition = `width ${timerSec}s linear`;
  $('timerBar').style.width = '0%';
  timerHandle = setInterval(tickTimer, 1000);
}
function stopTimer()  { clearInterval(timerHandle); timerHandle = null; }
function tickTimer()  {
  timerSec--;
  const pct = timerSec / timeLimit;
  $('timerBar').className = 'timer-bar' + (pct < 0.2 ? ' danger' : pct < 0.4 ? ' warn' : '');
  if (timerSec <= 0) { stopTimer(); onTimeout(); }
}
function onTimeout() {
  if (busy) return;
  busy = true;
  $('feedback').textContent = 'â° ÙˆÙ‚Øª ØªÙ…Ø§Ù… Ø´Ø¯!';
  $('feedback').className = 'feedback bad';
  setTimeout(() => {
    $('feedback').textContent = '';
    qIdx++;
    if (qIdx > qPerLevel) { levelIdx++; qIdx = 1; }
    newQuestion();
  }, 1600);
}

/* â”€â”€â”€ PROGRESS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function updateProgress() {
  const done  = levelIdx * qPerLevel + (qIdx - 1);
  const total = LEVELS.length * qPerLevel;
  $('progBar').style.width = (done / total * 100) + '%';
}

/* â”€â”€â”€ STARS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function spawnStars() {
  const layer = $('starLayer');
  ['â­','ğŸŒŸ','âœ¨','ğŸ’«','ğŸ‰','âš¡'].slice(0, 5).forEach((e, i) => {
    const s = document.createElement('div');
    s.className = 'fstar'; s.textContent = e;
    s.style.left = (5 + Math.random() * 90) + '%';
    s.style.top  = (10 + Math.random() * 75) + '%';
    s.style.fontSize = (20 + Math.random() * 16) + 'px';
    s.style.animationDelay = (i * 0.1) + 's';
    layer.appendChild(s);
    setTimeout(() => s.remove(), 1200);
  });
}

/* â”€â”€â”€ END GAME + SAVE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
async function endGame() {
  const max = LEVELS.length * qPerLevel * 10;
  const pct = score / max;
  const [trophy, title, grade] =
    pct >= 0.9 ? ['ğŸ†','Ø¹Ø§Ù„ÛŒ!','ØªÙˆ ÛŒÙ‡ Ù‚Ù‡Ø±Ù…Ø§Ù† Ø¬Ø¯ÙˆÙ„ Ø¶Ø±Ø¨ÛŒ! ğŸ”¥'] :
    pct >= 0.7 ? ['ğŸ¥‡','Ø¢ÙØ±ÛŒÙ†!','Ú©Ø§Ø±Øª Ø®ÛŒÙ„ÛŒ Ø®ÙˆØ¨ Ø¨ÙˆØ¯ ğŸ‘'] :
    pct >= 0.5 ? ['ğŸ¥ˆ','Ø®ÙˆØ¨ Ø¨ÙˆØ¯!','Ø¨Ø§ ØªÙ…Ø±ÛŒÙ† Ø¨Ù‡ØªØ± Ù…ÛŒâ€ŒØ´ÛŒ ğŸ’ª'] :
                 ['ğŸ¯','ØªÙ„Ø§Ø´ Ú©Ù†!','Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø§Ù…ØªØ­Ø§Ù† Ú©Ù†ØŒ Ù…ÛŒâ€ŒØªÙˆÙ†ÛŒ! ğŸ˜Š'];

  $('endTrophy').textContent = trophy;
  $('endTitle').textContent  = title;
  $('endGrade').textContent  = grade;
  $('endScore').textContent  = toF(score);
  $('endMax').textContent    = toF(max);
  $('endPct').textContent    = toF(Math.round(pct * 100)) + 'Ùª';
  $('rankBanner').textContent = 'â³ Ø¯Ø± Ø­Ø§Ù„ Ø«Ø¨Øª Ø§Ù…ØªÛŒØ§Ø²...';
  show('endScreen');
  spawnStars(); spawnStars();

  try {
    await saveScore({ name: playerName, score, difficulty, questionsPerLevel: qPerLevel });
    const scores = await fetchScores();
    const sorted = [...scores].sort((a,b) => b.score - a.score);
    const rank   = sorted.findIndex(s => s.name.toLowerCase() === playerName.toLowerCase()) + 1;
    $('rankBanner').textContent =
      rank === 1 ? `ğŸ¥‡ ØªÙˆ Ø§ÙˆÙ„ Ø´Ø¯ÛŒ Ø§Ø² ${toF(sorted.length)} Ù†ÙØ±! ğŸ‰`
                 : `ğŸ… Ø±ØªØ¨Ù‡ ${toF(rank)} Ø§Ø² ${toF(sorted.length)} Ù†ÙØ±`;
  } catch(err) {
    console.error('endGame save error:', err);
    $('rankBanner').textContent = isConfigured()
      ? `âš ï¸ Ø®Ø·Ø§: ${err.message}`
      : 'âš™ï¸ Ø¨Ø±Ø§ÛŒ Ø«Ø¨Øª Ø§Ù…ØªÛŒØ§Ø²ØŒ JSONBin Ø±Ùˆ ØªÙ†Ø¸ÛŒÙ… Ú©Ù†';
  }
}

/* â”€â”€â”€ JSONBIN API â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
/*
   JSONBin read needs the bin to be PUBLIC or use the Access Key.
   Make sure your bin is set to PUBLIC:
   Bins â†’ click your bin â†’ Settings â†’ Make Public âœ“
   OR keep it private and the X-Access-Key header will authenticate reads.
*/
function isConfigured() {
  return JSONBIN_ID !== 'YOUR_BIN_ID_HERE' && JSONBIN_KEY !== 'YOUR_API_KEY_HERE';
}

async function fetchScores() {
  if (!isConfigured()) return [];
  const res = await fetch(API_BASE + '/latest', { headers: HEADERS });
  if (!res.ok) {
    const txt = await res.text();
    console.error('JSONBin fetch error:', res.status, txt);
    throw new Error(`HTTP ${res.status}: ${txt}`);
  }
  const data = await res.json();
  const arr  = Array.isArray(data.record) ? data.record : [];
  // Filter out the placeholder setup entry
  return arr.filter(s => s && s.name && s.name !== 'test' && !s.setup);
}

async function saveScore(entry) {
  if (!isConfigured()) return;
  const scores = await fetchScores(); // already filtered

  // Keep personal best only
  const idx = scores.findIndex(s => s.name.toLowerCase() === entry.name.toLowerCase());
  if (idx >= 0) {
    if (scores[idx].score < entry.score) scores[idx] = { ...entry, date: new Date().toISOString() };
  } else {
    scores.push({ ...entry, date: new Date().toISOString() });
  }

  const res = await fetch(API_BASE, {
    method: 'PUT',
    headers: HEADERS,
    body: JSON.stringify(scores)
  });
  if (!res.ok) {
    const txt = await res.text();
    console.error('JSONBin save error:', res.status, txt);
    throw new Error(`Save HTTP ${res.status}`);
  }
}

async function deleteScore(name) {
  if (!isConfigured() || !teacherMode) return;
  const scores = await fetchScores();
  const filtered = scores.filter(s => s.name.toLowerCase() !== name.toLowerCase());
  await fetch(API_BASE, { method:'PUT', headers:HEADERS, body:JSON.stringify(filtered) });
}

/* â”€â”€â”€ LEADERBOARD UI â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
async function openLB() {
  $('lbOverlay').classList.remove('hidden');
  await loadLB();
}
function closeLB() { $('lbOverlay').classList.add('hidden'); }
function closeLBOutside(e) { if (e.target === $('lbOverlay')) closeLB(); }

function setTab(f, btn) {
  lbTab = f;
  document.querySelectorAll('.lb-tab').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  renderLB();
}

async function loadLB() {
  $('lbContent').innerHTML = '<div class="lb-loading">â³</div>';
  if (!isConfigured()) {
    $('lbContent').innerHTML = `
      <div class="config-notice">
        âš™ï¸ Ø¨Ø±Ø§ÛŒ ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† ØªØ§Ø¨Ù„ÙˆÛŒ Ø§Ù…ØªÛŒØ§Ø²Ø§Øª:<br>
        Û±. Ø¨Ø±Ùˆ Ø¨Ù‡ <a href="https://jsonbin.io" target="_blank">jsonbin.io</a> Ùˆ Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ú©Ù†<br>
        Û². ÛŒÙ‡ Bin Ø¨Ø§ Ù…Ø­ØªÙˆØ§ÛŒ <code>[]</code> Ø¨Ø³Ø§Ø²<br>
        Û³. BIN_ID Ùˆ API_KEY Ø±Ùˆ Ø¯Ø± ÙØ§ÛŒÙ„ HTML Ù¾Ø± Ú©Ù†
      </div>`;
    return;
  }
  try {
    allScores = await fetchScores();
    renderLB();
  } catch(err) {
    console.error('loadLB error:', err);
    $('lbContent').innerHTML = `
      <div class="lb-empty">
        âš ï¸ Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ<br>
        <small style="color:var(--muted);font-size:12px;margin-top:8px;display:block">
          ${esc(err.message)}<br>
          BIN ID Ùˆ API Key Ø±Ùˆ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ú†Ú© Ú©Ù†
        </small>
      </div>`;
  }
}

function renderLB() {
  const filtered = lbTab === 'all'
    ? allScores
    : allScores.filter(s => s.difficulty === lbTab);
  filtered.sort((a,b) => b.score - a.score);

  if (!filtered.length) {
    $('lbContent').innerHTML = '<div class="lb-empty">ğŸœï¸ Ù‡Ù†ÙˆØ² Ø§Ù…ØªÛŒØ§Ø²ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡!</div>';
    return;
  }

  const medal = i => ['ğŸ¥‡','ğŸ¥ˆ','ğŸ¥‰'][i] || `${toF(i+1)}.`;
  const cls   = i => ['top-1','top-2','top-3'][i] || '';

  const rows = filtered.map((s, i) => {
    const isMe = s.name.toLowerCase() === playerName.toLowerCase();
    const date = s.date ? new Date(s.date).toLocaleDateString('fa-IR',{month:'short',day:'numeric'}) : '';
    return `
      <div class="lb-row ${cls(i)} ${isMe?'me':''}" style="animation-delay:${i*0.04}s">
        <div class="lb-rank">${medal(i)}</div>
        <div class="lb-info">
          <div class="lb-name">${esc(s.name)}${isMe?' (ØªÙˆ)':''}</div>
          <div class="lb-sub">${DIFF_FA[s.difficulty]||''} ${date?'Â· '+date:''}</div>
        </div>
        <div class="lb-score-val">${toF(s.score)}</div>
        <button class="lb-del" onclick="delEntry('${esc(s.name)}')">ğŸ—‘</button>
      </div>`;
  }).join('');

  $('lbContent').innerHTML = `<div class="lb-list ${teacherMode?'teacher-mode':''}">${rows}</div>`;
}

async function delEntry(name) {
  if (!confirm(`Ø­Ø°Ù Ø§Ù…ØªÛŒØ§Ø² "${name}"ØŸ`)) return;
  await deleteScore(name);
  allScores = allScores.filter(s => s.name.toLowerCase() !== name.toLowerCase());
  renderLB();
}

const esc = s => String(s).replace(/[&<>"']/g, c =>
  ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
</script>
</body>
</html>